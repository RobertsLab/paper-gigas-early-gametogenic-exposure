getwd()
setwd("../../") #Set working directory as repository
getwd()
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
head(hatchRate) #Confirm import
hatchRatepHOnly <- hatchRate[-c(25:26),] #Remove heat shock data
tail(hatchRatepHOnly) #Confirm removal
hatchRatepHOnly$Parental.Treatment <- factor(hatchRatepHOnly$Parental.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Female.Treatment <- factor(hatchRatepHOnly$Female.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Male.Treatment <- factor(hatchRatepHOnly$Male.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly <- hatchRatepHOnly[-24,] #Remove outlier from Ambient-Ambient group
tail(hatchRatepHOnly) #Confirm removal
hatchRatepHTreatmentANOVA <- aov(Average.Hatch.Rate ~ Parental.Treatment, data = hatchRatepHOnly) #One-way ANOVA by parental treatment
summary(hatchRatepHTreatmentANOVA)[[1]][["F value"]][[1]] #F = 3.10953
summary(hatchRatepHTreatmentANOVA)[[1]][["Pr(>F)"]][[1]] #p = 0.05082859
plot(x = hatchRatepHOnly$Parental.Treatment, y = hatchRatepHOnly$Average.Hatch.Rate, cex.axis = 2) #Preliminary plot. Will modify in InDesign for publication
histologyData <- read.csv("2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
histologyData <- read.csv("2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
head(histologyData) #Confirm import
histologyData <- read.csv("2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
histologyData <- read.csv("analyses/Gonad-Histology/2018-02-27-Histology-Classification-Analyses.R") #Import histology data
head(histologyData) #Confirm import
head(histologyData) #Confirm import
head(histologyData)
View(histologyData)
histologyData <- read.csv("data/2017-Adult-Gigas-Tissue-Sampling/2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
head(histologyData)
histologyData <- read.csv("2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
histologyData <- read.csv("data/2017-Adult-Gigas-Tissue-Sampling/2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
head(histologyData)
mature.stage <- 3 #Set the maturation stage to be anything that is ripe and spawning
histologyData$Mature <- rep(0, nrow(histologyData)) #Create a new column for Yes/No information on maturity. 0 is immature, 1 is mature
histologyData$Mature[which(histologyData$Stage >= mature.stage)] <- rep(1, length(which(histologyData$Stage >= mature.stage))) #For anything where the stage is greater than or equal to the mature.stage, replace it with a 1
head(histologyData) #Confirm changes
histologyData$Treatment <- c(rep("Ambient", times = 20), rep("Low", times = 10), rep("Ambient", times = 10)) #Create a treatment column
head(histologyData) #Confirm changes
histologyData$modifiedSex <- rep(0, nrow(histologyData)) #Create a new column to modify sex classifications
histologyData$modifiedSex[which(histologyData$Sex == "N/A")] <- rep("unripe", length(which(histologyData$Sex == "N/A"))) #For anything where sex is N/A, replace 0 with "unripe"
histologyData$modifiedSex[which(histologyData$Sex == "female")] <- rep("female", length(which(histologyData$Sex == "female"))) #For anything where sex is female, replace 0 with "female"
histologyData$modifiedSex[which(histologyData$Sex == "male")] <- rep("male", length(which(histologyData$Sex == "male"))) #For anything where sex is male, replace 0 with "male"
head(histologyData) #Confirm changes
install.packages("lme4")
library(lme4)
?glmer
mature.glmer1 <- glmer(Mature ~ factor(Treatment) + (1|Tank), family = binomial(link = "logit"), data = histologyData) #Ambient vs. low pH
anova(mature.glm1)
anova(mature.glmer1)
mature.glm2 <- glmer(Mature ~ factor(modifiedSex) + (1|Tank), family = binomial(link = "logit"), data = histologyData) #Female vs. male vs. unripe
anova(mature.glmer2)
mature.glmer2 <- glmer(Mature ~ factor(modifiedSex) + (1|Tank), family = binomial(link = "logit"), data = histologyData) #Female vs. male vs. unripe
anova(mature.glmer2)
mature.glmer3 <- glmer(Mature ~ Ferrous.inclusion.presence + (1|Tank), family = binomial(link = "logit"), data = histologyData) #Ferrous inclusion vs. no ferrous inclusions
anova(mature.glmer3)
mature.glmer4 <- glmer(Mature ~ Pre.or.Post.OA + (1|Tank), family = binomial(link = "logit"), data = histologyData) #Pre vs. post sampling
anova(mature.glmer4)
summary(mature.glmer1)
summary(mature.glmer2)
summary(mature.glmer3)
summary(mature.glmer4)
summary(mature.glmer1)
summary(mature.glmer2)
summary(mature.glmer3)
summary(mature.glmer4)
anova(mature.glmer2)
anova(mature.glmer1)
Anova(mature.glmer1)
summary(mature.glmer2) #AIC  = 27.2
summary(mature.glmer3) #AIC = 39.3
summary(mature.glmer4) #AIC = 39.0
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
head(hatchRate) #Confirm import
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data-with-Sire.csv", header = TRUE) #Import hatch rate data
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
head(hatchRate) #Confirm import
hatchRatepHOnly <- hatchRate[-c(25:26),] #Remove heat shock data
tail(hatchRatepHOnly) #Confirm removal
hatchRatepHOnly$Parental.Treatment <- factor(hatchRatepHOnly$Parental.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Female.Treatment <- factor(hatchRatepHOnly$Female.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Male.Treatment <- factor(hatchRatepHOnly$Male.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly <- hatchRatepHOnly[-24,] #Remove outlier from Ambient-Ambient group
tail(hatchRatepHOnly) #Confirm removal
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
library(lme4) #Load package
install.packages("car") #Install package
library(car) #Load package for ANOVA
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer)
Anova(hatchRatepHTreatment.lmer)
hatchRatepHTreatment.lmer2 <- lmer(Average.Hatch.Rate ~ Female.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer2) #Sire: Variance = 0.0002569, St. Dev = 0.01603. Variance range overlaps zero, so I can pool by male treatment
Anova(hatchRatepHTreatment.lmer2) # Pr(>Chisq) = 0.02445
histologyData <- read.csv("data/2017-Adult-Gigas-Tissue-Sampling/2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
head(histologyData)
histologyData <- read.csv("data/2017-Adult-Gigas-Tissue-Sampling/2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
head(histologyData)
mature.stage <- 3 #Set the maturation stage to be anything that is ripe and spawning
histologyData$Mature <- rep(0, nrow(histologyData)) #Create a new column for Yes/No information on maturity. 0 is immature, 1 is mature
histologyData$Mature[which(histologyData$Stage >= mature.stage)] <- rep(1, length(which(histologyData$Stage >= mature.stage))) #For anything where the stage is greater than or equal to the mature.stage, replace it with a 1
head(histologyData) #Confirm changes
histologyData$Treatment <- c(rep("Ambient", times = 20), rep("Low", times = 10), rep("Ambient", times = 10)) #Create a treatment column
head(histologyData) #Confirm changes
histologyData$modifiedSex <- rep(0, nrow(histologyData)) #Create a new column to modify sex classifications
histologyData$modifiedSex[which(histologyData$Sex == "N/A")] <- rep("unripe", length(which(histologyData$Sex == "N/A"))) #For anything where sex is N/A, replace 0 with "unripe"
histologyData$modifiedSex[which(histologyData$Sex == "female")] <- rep("female", length(which(histologyData$Sex == "female"))) #For anything where sex is female, replace 0 with "female"
histologyData$modifiedSex[which(histologyData$Sex == "male")] <- rep("male", length(which(histologyData$Sex == "male"))) #For anything where sex is male, replace 0 with "male"
head(histologyData) #Confirm changes
#Find first significant variable using a binomial GLM and cannonical logit link
mature.glm1 <- glm(Mature ~ factor(Treatment), family = binomial(link = "logit"), data = histologyData) #Ambient vs. low pH
anova(mature.glm1)
1-pf(3.7926/(30.024/38), 1, 38) #0.03466119 (Use Deviance/(ResDev/ResDF) to find F-value)
mature.glm2 <- glm(Mature ~ factor(modifiedSex), family = binomial(link = "logit"), data = histologyData) #Female vs. male vs. unripe
anova(mature.glm2)
1-pf(13.175/(20.641/37), 2, 37) #2.456105e-07. modifiedSex is the most significant, so this is the base model
mature.glm3 <- glm(Mature ~ Ferrous.inclusion.presence, family = binomial(link = "logit"), data = histologyData) #Ferrous inclusion vs. no ferrous inclusions
anova(mature.glm3)
1-pf(0.24821/(33.569/38), 1, 38) #0.5991481
mature.glm4 <- glm(Mature ~ Pre.or.Post.OA, family = binomial(link = "logit"), data = histologyData) #Pre vs. post sampling
anova(mature.glm4)
1-pf(0.79731/(33.019/38), 1, 38) #0.3441647
#Use add1 to find next significant variable
add1(mature.glm2, ~. + factor(Treatment) + Ferrous.inclusion.presence, test = "F", data = histologyData) #Neither variable is significant, so none will be included. modifiedSex is the only significant predictor
#See where differences are in mature.glm2
summary(mature.glm2) #Males are more mature than females
#### CALCULATE CONTINGENCY TABLE VALUES ####
maleLow <- length(which(histologyData$Treatment == "Low" & histologyData$modifiedSex == "male")) #Count the number of oysters that are male and were exposed to low pH
femaleLow <- length(which(histologyData$Treatment == "Low" & histologyData$modifiedSex == "female"))
unripeLow <- length(which(histologyData$Treatment == "Low" & histologyData$modifiedSex == "unripe"))
maleAmb <- length(which(histologyData$Treatment == "Ambient" & histologyData$modifiedSex == "male" & histologyData$Pre.or.Post.OA == "Post")) #Include specification for post-treamtent samples only
femaleAmb <- length(which(histologyData$Treatment == "Ambient" & histologyData$modifiedSex == "female" & histologyData$Pre.or.Post.OA == "Post")) #Include specification for post-treamtent samples only
unripeAmb <- length(which(histologyData$Treatment == "Ambient" & histologyData$modifiedSex == "unripe" & histologyData$Pre.or.Post.OA == "Post")) #Include specification for post-treamtent samples only
#### CREATE CONTINGENCY TABLE ####
sexRatioContingencyTable <- data.frame("count" = c(maleLow, femaleLow, unripeLow, maleAmb, femaleAmb, unripeAmb),
"row" = c(rep(1, times = 3), rep(2, times = 3)),
"column" = c(1, 2, 3, 1, 2, 3)) #Make contingency table where rows specify pH treatment and columns specify sex classification
head(sexRatioContingencyTable) #Confirm table creation
r <- as.factor(sexRatioContingencyTable$row) #Recognize as factor
c <- as.factor(sexRatioContingencyTable$column) #Recognize as factor
#### TEST INDEPENDENT VARIABLES ####
ratio.glm1 <- glm(count ~ r + c, family = poisson(link = "log"), data = sexRatioContingencyTable) #Create a poisson GLM with a log link
anova(ratio.glm1)
1-pchisq(3.2779, 2) #0.1941838, Insignificant, so model fits. Testing interaction will leave df = 0. Sex ratios are homogenous between low and ambient pH treatments.
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
head(hatchRate) #Confirm import
hatchRatepHOnly <- hatchRate[-c(25:26),] #Remove heat shock data
tail(hatchRatepHOnly) #Confirm removal
hatchRatepHOnly$Parental.Treatment <- factor(hatchRatepHOnly$Parental.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Female.Treatment <- factor(hatchRatepHOnly$Female.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Male.Treatment <- factor(hatchRatepHOnly$Male.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly <- hatchRatepHOnly[-24,] #Remove outlier from Ambient-Ambient group
tail(hatchRatepHOnly) #Confirm removal
install.packages("car") #Install package do run ANOVA with lmer results
library(lme4) #Load package
library(car) #Load package for ANOVA
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603. Variance range overlaps zero, so I can pool by male treatment
Anova(hatchRatepHTreatment.lmer) # Pr(>Chisq) = 0.02445
hatchRatepHTreatment.lmer2 <- lmer(Average.Hatch.Rate ~ Female.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer2) #Sire: Variance = 8.871e-05, St. Dev = 0.009418. Variance range overlaps zero
summary(hatchRatepHTreatment.lmer2) #Sire: Variance = 8.871e-05, St. Dev = 0.009418
Anova(hatchRatepHTreatment.lmer2) # Pr(>Chisq) = 0.00271
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603. Variance range overlaps zero, so pooling is justified
summary(hatchRatepHTreatment.lmer2) #Sire: Variance = 8.871e-05, St. Dev = 0.009418
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603. Variance range overlaps zero, so pooling is justified
install.packages("lmerTest") #Install package do run ANOVA with lmer results
library(lmerTest) #Load package for ANOVA
anova(hatchRatepHTreatment.lmer) # Pr(>Chisq) = 0.02445
anova(hatchRatepHTreatment.lmer) #F-value = 3.1325
anova(hatchRatepHTreatment.lmer2) #F-value =
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603. Variance range overlaps zero, so pooling is justified
anova(hatchRatepHTreatment.lmer) #F-value = 3.1325
hatchRatepHTreatment.lmer2 <- lmer(Average.Hatch.Rate ~ Female.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect to investigate maternal effects
summary(hatchRatepHTreatment.lmer2) #Sire: Variance = 8.871e-05, St. Dev = 0.009418
anova(hatchRatepHTreatment.lmer2) #F-value = 8.9928
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603. Variance range overlaps zero, so pooling is justified
var.lmer <- c(0.0002569, 0.0298603) #Save variances of random effects as a new vector
percentvar.lmer <- (100*var.lmer)/sum(var.lmer) #Calculate percent variances
percentvar.lmer[1] #
percentvar.lmer[2] #
summary(hatchRatepHTreatment.lmer2) #Sire: Variance = 8.871e-05, St. Dev = 0.009418. Female.TreatmentLow: t-value = -2.999, Pr(>|t|) = 0.0119
var.lmer2 <- c(8.871e-05, 2.838e-02) #Save variances of random effects as a new vector
percentvar.lmer2 <- (100*var.lmer2)/sum(var.lmer2) #Calculate percent variances
percentvar.lmer2[1] #Sire accounts for 0.8530009% of variance
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603. Variance range overlaps zero, so pooling is justified
summary(hatchRatepHTreatment.lmer2) #Sire: Variance = 8.871e-05, St. Dev = 0.009418. Female.TreatmentLow: t-value = -2.999, Pr(>|t|) = 0.0119
summary(hatchRatepHTreatment.lmer2) #Sire: Variance = 8.871e-05, St. Dev = 0.009418. Female.TreatmentLow: t-value = -2.999, Pr(>|t|) = 0.0119
head(sexRatioContingencyTable) #Confirm table creation
histologyData <- read.csv("data/2017-Adult-Gigas-Tissue-Sampling/2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
head(histologyData)
mature.stage <- 3 #Set the maturation stage to be anything that is ripe and spawning
histologyData$Mature <- rep(0, nrow(histologyData)) #Create a new column for Yes/No information on maturity. 0 is immature, 1 is mature
histologyData$Mature[which(histologyData$Stage >= mature.stage)] <- rep(1, length(which(histologyData$Stage >= mature.stage))) #For anything where the stage is greater than or equal to the mature.stage, replace it with a 1
head(histologyData) #Confirm changes
histologyData$Treatment <- c(rep("Ambient", times = 20), rep("Low", times = 10), rep("Ambient", times = 10)) #Create a treatment column
head(histologyData) #Confirm changes
histologyData$modifiedSex <- rep(0, nrow(histologyData)) #Create a new column to modify sex classifications
histologyData$modifiedSex[which(histologyData$Sex == "N/A")] <- rep("unripe", length(which(histologyData$Sex == "N/A"))) #For anything where sex is N/A, replace 0 with "unripe"
histologyData$modifiedSex[which(histologyData$Sex == "female")] <- rep("female", length(which(histologyData$Sex == "female"))) #For anything where sex is female, replace 0 with "female"
histologyData$modifiedSex[which(histologyData$Sex == "male")] <- rep("male", length(which(histologyData$Sex == "male"))) #For anything where sex is male, replace 0 with "male"
head(histologyData) #Confirm changes
#Find first significant variable using a binomial GLM and cannonical logit link
mature.glm1 <- glm(Mature ~ factor(Treatment), family = binomial(link = "logit"), data = histologyData) #Ambient vs. low pH
anova(mature.glm1)
1-pf(3.7926/(30.024/38), 1, 38) #0.03466119 (Use Deviance/(ResDev/ResDF) to find F-value)
mature.glm2 <- glm(Mature ~ factor(modifiedSex), family = binomial(link = "logit"), data = histologyData) #Female vs. male vs. unripe
anova(mature.glm2)
1-pf(13.175/(20.641/37), 2, 37) #2.456105e-07. modifiedSex is the most significant, so this is the base model
mature.glm3 <- glm(Mature ~ Ferrous.inclusion.presence, family = binomial(link = "logit"), data = histologyData) #Ferrous inclusion vs. no ferrous inclusions
anova(mature.glm3)
1-pf(0.24821/(33.569/38), 1, 38) #0.5991481
mature.glm4 <- glm(Mature ~ Pre.or.Post.OA, family = binomial(link = "logit"), data = histologyData) #Pre vs. post sampling
anova(mature.glm4)
1-pf(0.79731/(33.019/38), 1, 38) #0.3441647
#Use add1 to find next significant variable
add1(mature.glm2, ~. + factor(Treatment) + Ferrous.inclusion.presence, test = "F", data = histologyData) #Neither variable is significant, so none will be included. modifiedSex is the only significant predictor
#See where differences are in mature.glm2
summary(mature.glm2) #Males are more mature than females
#### CALCULATE CONTINGENCY TABLE VALUES ####
maleLow <- length(which(histologyData$Treatment == "Low" & histologyData$modifiedSex == "male")) #Count the number of oysters that are male and were exposed to low pH
femaleLow <- length(which(histologyData$Treatment == "Low" & histologyData$modifiedSex == "female"))
unripeLow <- length(which(histologyData$Treatment == "Low" & histologyData$modifiedSex == "unripe"))
maleAmb <- length(which(histologyData$Treatment == "Ambient" & histologyData$modifiedSex == "male" & histologyData$Pre.or.Post.OA == "Post")) #Include specification for post-treamtent samples only
femaleAmb <- length(which(histologyData$Treatment == "Ambient" & histologyData$modifiedSex == "female" & histologyData$Pre.or.Post.OA == "Post")) #Include specification for post-treamtent samples only
unripeAmb <- length(which(histologyData$Treatment == "Ambient" & histologyData$modifiedSex == "unripe" & histologyData$Pre.or.Post.OA == "Post")) #Include specification for post-treamtent samples only
#### CREATE CONTINGENCY TABLE ####
sexRatioContingencyTable <- data.frame("count" = c(maleLow, femaleLow, unripeLow, maleAmb, femaleAmb, unripeAmb),
"row" = c(rep(1, times = 3), rep(2, times = 3)),
"column" = c(1, 2, 3, 1, 2, 3)) #Make contingency table where rows specify pH treatment and columns specify sex classification
head(sexRatioContingencyTable) #Confirm table creation
r <- as.factor(sexRatioContingencyTable$row) #Recognize as factor
c <- as.factor(sexRatioContingencyTable$column) #Recognize as factor
#### CHI-SQUARED OF HOMOGENEITY ####
ratio.glm1 <- glm(count ~ r + c, family = poisson(link = "log"), data = sexRatioContingencyTable) #Create a poisson GLM with a log link
anova(ratio.glm1)
View(sexRatioContingencyTable)
View(sexRatioContingencyTable)
#### LOAD DEPENDENCIES ####
library(seacarb)
#### LOAD DEPENDENCIES ####
install.packages("seacarb")
library(seacarb)
#### IMPORT DATAFRAME ####
seacarbInputs <- read.csv("2018-04-30-Seacarb-Inputs.csv", header = TRUE)
#### IMPORT DATAFRAME ####
seacarbInputs <- read.csv("data/2018-04-30-Seacarb-Inputs.csv", header = TRUE)
#### IMPORT DATAFRAME ####
seacarbInputs <- read.csv("data/Water-Chemistry-Data/2018-04-30-In-Situ-Variable-Calculations/2018-04-30-Seacarb-Inputs.csv", header = TRUE) #Import dataframe
head(seacarbInputs) #Confirm import
#### CALCULATE PARAMETERS USING SEACARB ####
carb.output <- carb(flag = 8, var1 = seacarbInputs$pH, var2 = seacarbInputs$TotalAlkalinity/1000000, S = seacarbInputs$Salinity, T = seacarbInputs$Temperature, P = 0, Pt = 0, Sit = 0, pHscale = "T", kf = "pf", k1k2 = "l", ks = "d") #Calculate seawater chemistry paramters
head(carb.output) #Confirm calculations
carb.output$ALK <- carb.output$ALK*1000000 #convert to µmol kg-1
carb.output$CO2 <- carb.output$CO2*1000000 #convert to µmol kg-1
carb.output$HCO3 <- carb.output$HCO3*1000000 #convert to µmol kg-1
carb.output$CO3 <- carb.output$CO3*1000000 #convert to µmol kg-1
carb.output$DIC <- carb.output$DIC*1000000 #convert to µmol kg-1
?carb
seacarbOutput <- cbind(seacarbInputs, carb.output) #Join tables together
head(seacarbOutput)
seacarbOutput <- cbind(seacarbInputs, carb.output) #Join tables together
head(seacarbOutput)
#### EXPORT DATA ####
write.csv(seacarbOutput, "2018-04-30-In-Situ-Carbonate-Chemistry-Parameters.csv", row.names = FALSE)
head(seacarbOutput)
#### EXPORT DATA ####
write.csv(seacarbOutput, "2018-04-30-In-Situ-Carbonate-Chemistry-Parameters.csv", row.names = FALSE)
View(seacarbOutput)
#### EXPORT DATA ####
write.csv(seacarbOutput, "data/Water-Chemistry-Data/2018-04-30-In-Situ-Variable-Calculations/2018-04-30-In-Situ-Carbonate-Chemistry-Parameters.csv", row.names = FALSE)
histologyData <- read.csv("data/2017-Adult-Gigas-Tissue-Sampling/2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
head(histologyData)
mature.stage <- 3 #Set the maturation stage to be anything that is ripe and spawning
histologyData$Mature <- rep(0, nrow(histologyData)) #Create a new column for Yes/No information on maturity. 0 is immature, 1 is mature
histologyData$Mature[which(histologyData$Stage >= mature.stage)] <- rep(1, length(which(histologyData$Stage >= mature.stage))) #For anything where the stage is greater than or equal to the mature.stage, replace it with a 1
head(histologyData) #Confirm changes
histologyData$Treatment <- c(rep("Ambient", times = 20), rep("Low", times = 10), rep("Ambient", times = 10)) #Create a treatment column
head(histologyData) #Confirm changes
histologyData$modifiedSex <- rep(0, nrow(histologyData)) #Create a new column to modify sex classifications
histologyData$modifiedSex[which(histologyData$Sex == "N/A")] <- rep("unripe", length(which(histologyData$Sex == "N/A"))) #For anything where sex is N/A, replace 0 with "unripe"
histologyData$modifiedSex[which(histologyData$Sex == "female")] <- rep("female", length(which(histologyData$Sex == "female"))) #For anything where sex is female, replace 0 with "female"
histologyData$modifiedSex[which(histologyData$Sex == "male")] <- rep("male", length(which(histologyData$Sex == "male"))) #For anything where sex is male, replace 0 with "male"
head(histologyData) #Confirm changes
#Find first significant variable using a binomial GLM and cannonical logit link
mature.glm1 <- glm(Mature ~ factor(Treatment), family = binomial(link = "logit"), data = histologyData) #Ambient vs. low pH
anova(mature.glm1)
1-pf(3.7926/(30.024/38), 1, 38) #0.03466119 (Use Deviance/(ResDev/ResDF) to find F-value)
mature.glm2 <- glm(Mature ~ factor(modifiedSex), family = binomial(link = "logit"), data = histologyData) #Female vs. male vs. unripe
anova(mature.glm2)
1-pf(13.175/(20.641/37), 2, 37) #2.456105e-07. modifiedSex is the most significant, so this is the base model
mature.glm3 <- glm(Mature ~ Ferrous.inclusion.presence, family = binomial(link = "logit"), data = histologyData) #Ferrous inclusion vs. no ferrous inclusions
anova(mature.glm3)
1-pf(0.24821/(33.569/38), 1, 38) #0.5991481
mature.glm4 <- glm(Mature ~ Pre.or.Post.OA, family = binomial(link = "logit"), data = histologyData) #Pre vs. post sampling
anova(mature.glm4)
1-pf(0.79731/(33.019/38), 1, 38) #0.3441647
#Use add1 to find next significant variable
add1(mature.glm2, ~. + factor(Treatment) + Ferrous.inclusion.presence, test = "F", data = histologyData) #Neither variable is significant, so none will be included. modifiedSex is the only significant predictor
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
head(hatchRate) #Confirm import
hatchRatepHOnly <- hatchRate[-c(25:26),] #Remove heat shock data
tail(hatchRatepHOnly) #Confirm removal
hatchRatepHOnly$Parental.Treatment <- factor(hatchRatepHOnly$Parental.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Female.Treatment <- factor(hatchRatepHOnly$Female.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Male.Treatment <- factor(hatchRatepHOnly$Male.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly <- hatchRatepHOnly[-24,] #Remove outlier from Ambient-Ambient group
tail(hatchRatepHOnly) #Confirm removal
install.packages("lme4") #Install package for linear mixed effect models
library(lme4) #Load package
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603. Variance range overlaps zero, so pooling is justified
#First I will look at all treatments
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire), data = hatchRatepHOnly, REML = FALSE) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603.
#First I will look at all treatments
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603.
#Likelihood Ratio Test for all treatments
hatchRatepHTreatment.lmer.null <- lmer(Average.Hatch.Rate ~ (1 | Sire), data = hatchRatepHOnly, REML = FALSE) #The null model does not include Parental.Treatment
anova(hatchRatepHTreatment.lmer.null, hatchRatepHTreatment.lmer.full) #Compare null and full models.
hatchRatepHTreatment.lmer.full <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire), data = hatchRatepHOnly, REML = FALSE) #Full model includes Parental.Treatment
anova(hatchRatepHTreatment.lmer.null, hatchRatepHTreatment.lmer.full) #Compare null and full models.
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603.
anova(hatchRatepHTreatment.lmer.null, hatchRatepHTreatment.lmer.full) #Compare null and full models.
#Likelihood Ratio Test for female treatments
hatchRatepHTreatment.lmer2.null <- lmer(Average.Hatch.Rate ~ (1 | Sire), data = hatchRatepHOnly, REML = FALSE) #The null model does not include Female.Treatment
hatchRatepHTreatment.lmer2.full <- lmer(Average.Hatch.Rate ~ Female.Treatment + (1 | Sire), data = hatchRatepHOnly, REML = FALSE) #Full model includes Female.Treatment
anova(hatchRatepHTreatment.lmer2.null, hatchRatepHTreatment.lmer2.full) #Compare null and full models. Parental treatment affected D-hinge counts (Chi-squared = 9.1878, df = 3, p = 0.0269). D-hinge counts were -0.15795 ± 0.10468 lower for low pH female-ambient male and -0.15795 ± 0.10509 lower for low pH female-low pH mal
hatchRatepHTreatment.lmer2 <- lmer(Average.Hatch.Rate ~ Female.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect to investigate maternal effects
summary(hatchRatepHTreatment.lmer2) #Sire: Variance = 8.871e-05, St. Dev = 0.009418. Female.TreatmentLow: t-value = -2.999, Pr(>|t|) = 0.0119
#First I will look at all treatments
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire) + (1 | Female.Treatment), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603.
#Likelihood Ratio Test for all treatments
hatchRatepHTreatment.lmer.null <- lmer(Average.Hatch.Rate ~ (1 | Sire) + (1 | Female.Treatment), data = hatchRatepHOnly, REML = FALSE) #The null model does not include Parental.Treatment
hatchRatepHTreatment.lmer.full <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire) + (1 | Female.Treatment), data = hatchRatepHOnly, REML = FALSE) #Full model includes Parental.Treatment
anova(hatchRatepHTreatment.lmer.null, hatchRatepHTreatment.lmer.full) #Compare null and full models. Parental treatment affected D-hinge counts (Chi-squared = 9.1878, df = 3, p = 0.0269). D-hinge counts were -0.15795 ± 0.10468 lower for low pH female-ambient male and -0.15795 ± 0.10509 lower for low pH female-low pH male.
#Check model assumptions: linearity, absence of heteroskedasticity, normality of residuals
plot(fitted(hatchRatepHTreatment.lmer2), residuals(hatchRatepHTreatment.lmer2))
abline(h = 0)
#Check model assumptions: linearity, absence of heteroskedasticity, normality of residuals
plot(fitted(hatchRatepHTreatment.lmer2), residuals(hatchRatepHTreatment.lmer2), xlab = "Fitted values", ylab = "Residuals")
abline(h = 0)
plot(fitted(hatchRatepHTreatment.lmer), residuals(hatchRatepHTreatment.lmer), xlab = "Fitted values", ylab = "Residuals")
hatchRatepHTreatment.lmer3 <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire) + (1 | Female.Treatment), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect
plot(fitted(hatchRatepHTreatment.lmer3), residuals(hatchRatepHTreatment.lmer3), xlab = "Fitted values", ylab = "Residuals")
#Check model assumptions: linearity, absence of heteroskedasticity, normality of residuals
plot(fitted(hatchRatepHTreatment.lmer2), residuals(hatchRatepHTreatment.lmer2), xlab = "Fitted values", ylab = "Residuals")
abline(h = 0)
#Normality of residuals
qqnorm(residuals(hatchRatepHTreatment.lmer2))
plot(y = x)
?qqnorm
qqline(hatchRatepHTreatment.lmer2)
qqline(residuals(hatchRatepHTreatment.lmer2))
#Linearity and homoskedasticity
plot(fitted(hatchRatepHTreatment.lmer2), resid(hatchRatepHTreatment.lmer2), xlab = "Fitted values", ylab = "Residuals")
abline(h = 0)
View(hatchRatepHOnly)
#Normality of residuals
qqnorm(residuals(hatchRatepHTreatment.lmer))
qqline(residuals(hatchRatepHTreatment.lmer)) #Data falls on a straight line, so it's similar to a normal distribution. There are no obvious violations of the normality assumption.
#Linearity and homoskedasticity
plot(fitted(hatchRatepHTreatment.lmer), residuals(hatchRatepHTreatment.lmer), xlab = "Fitted values", ylab = "Residuals")
abline(h = 0)
#### MANCHESTER PAPER FIGURES ####
#jpeg(filename = "analyses/Manchester_ReproductiveOutput_20180214/2018-04-16-Manchester-Paper-Figure.jpeg", width = 1500, height = 1000)
plot(x = hatchRatepHOnly$Parental.Treatment, y = hatchRatepHOnly$Average.Hatch.Rate, cex.axis = 2) #Preliminary plot. Will modify in InDesign for publication
#### MANCHESTER PAPER FIGURES ####
#jpeg(filename = "analyses/Manchester_ReproductiveOutput_20180214/2018-04-16-Manchester-Paper-Figure.jpeg", width = 1500, height = 1000)
plot(x = hatchRatepHOnly$Parental.Treatment, y = hatchRatepHOnly$Average.Hatch.Rate, cex.axis = 2, col = "grey") #Preliminary plot. Will modify in InDesign for publication
#### MANCHESTER PAPER FIGURES ####
#jpeg(filename = "analyses/Manchester_ReproductiveOutput_20180214/2018-04-16-Manchester-Paper-Figure.jpeg", width = 1500, height = 1000)
plot(x = hatchRatepHOnly$Parental.Treatment, y = hatchRatepHOnly$Average.Hatch.Rate, cex.axis = 2, col = "light grey") #Preliminary plot. Will modify in InDesign for publication
#### MANCHESTER PAPER FIGURES ####
jpeg(filename = "analyses/Manchester_ReproductiveOutput_20180214/2018-04-16-Manchester-Paper-Figure.jpeg", width = 1500, height = 1000)
plot(x = hatchRatepHOnly$Parental.Treatment, y = hatchRatepHOnly$Average.Hatch.Rate, cex.axis = 2, col = "light grey") #Preliminary plot. Will modify in InDesign for publication
dev.off()
#### MANCHESTER PAPER FIGURES ####
jpeg(filename = "analyses/Gonad-Histology/2018-04-16-Manchester-Paper-Figure.jpeg", width = 1500, height = 1000)
plot(x = hatchRatepHOnly$Parental.Treatment, y = hatchRatepHOnly$Average.Hatch.Rate, cex.axis = 2, col = "light grey") #Preliminary plot. Will modify in InDesign for publication
dev.off()
plot(x = hatchRatepHOnly$Female.Treatment, y = hatchRatepHOnly$Average.Hatch.Rate, cex.axis = 2, col = "light grey") #Preliminary plot. Will modify in InDesign for publication
jpeg(filename = "analyses/Gonad-Histology/2018-07-30-Manchester-Paper-Figure2.jpeg", width = 1500, height = 1000)
plot(x = hatchRatepHOnly$Female.Treatment, y = hatchRatepHOnly$Average.Hatch.Rate, cex.axis = 2, col = "light grey") #Preliminary plot. Will modify in InDesign for publication
dev.off()
dev.off()
dev.off()
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
head(hatchRate) #Confirm import
hatchRatepHOnly <- hatchRate[-c(25:26),] #Remove heat shock data
tail(hatchRatepHOnly) #Confirm removal
hatchRatepHOnly$Parental.Treatment <- factor(hatchRatepHOnly$Parental.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Female.Treatment <- factor(hatchRatepHOnly$Female.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly$Male.Treatment <- factor(hatchRatepHOnly$Male.Treatment) #Make sure residual factors are no longer present
hatchRatepHOnly <- hatchRatepHOnly[-24,] #Remove outlier from Ambient-Ambient group
tail(hatchRatepHOnly) #Confirm removal
library(lme4) #Load package
#First I will look at all treatments
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire) + (1 | Female.Treatment), data = hatchRatepHOnly) #Linear mixed effect model using Sire and Female.Treatment (female pool) as a random effect
#First I will look at all treatments
hatchRatepHTreatment.lmer <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire) + (1 | Female.Treatment), data = hatchRatepHOnly) #Linear mixed effect model using Sire and Female.Treatment (female pool) as a random effect
summary(hatchRatepHTreatment.lmer) #Sire: Variance = 0.0002569, St. Dev = 0.01603.
var.lmer <- c(0.0002569, 0.0009835, 0.0298603) #Save variances of random effects as a new vector
percentvar.lmer <- (100*var.lmer)/sum(var.lmer) #Calculate percent variances
percentvar.lmer[1] #Sire accounts for 0.8530009% of variance
percentvar.lmer[2] #Female pool accounts for
percentvar.lmer[3]
#Likelihood Ratio Test for all treatments
hatchRatepHTreatment.lmer.null <- lmer(Average.Hatch.Rate ~ (1 | Sire) + (1 | Female.Treatment), data = hatchRatepHOnly, REML = FALSE) #The null model does not include Parental.Treatment
hatchRatepHTreatment.lmer.full <- lmer(Average.Hatch.Rate ~ Parental.Treatment + (1 | Sire) + (1 | Female.Treatment), data = hatchRatepHOnly, REML = FALSE) #Full model includes Parental.Treatment
anova(hatchRatepHTreatment.lmer.null, hatchRatepHTreatment.lmer.full) #Compare null and full models. Parental treatment affected D-hinge counts (Chi-squared = 9.1878, df = 3, p = 0.0269). D-hinge counts were -0.15795 ± 0.10468 lower for low pH female-ambient male and -0.15795 ± 0.10509 lower for low pH female-low pH male.
#Normality of residuals
qqnorm(residuals(hatchRatepHTreatment.lmer))
qqline(residuals(hatchRatepHTreatment.lmer)) #Data falls on a straight line, so it's similar to a normal distribution. There are no obvious violations of the normality assumption.
#Linearity and homoskedasticity
plot(fitted(hatchRatepHTreatment.lmer), residuals(hatchRatepHTreatment.lmer), xlab = "Fitted values", ylab = "Residuals")
abline(h = 0)
#Normality of residuals
qqnorm(residuals(hatchRatepHTreatment.lmer2))
qqline(residuals(hatchRatepHTreatment.lmer2)) #Data falls on a straight line, so it's similar to a normal distribution. There are no obvious violations of the normality assumption.
hatchRatepHTreatment.lmer2 <- lmer(Average.Hatch.Rate ~ Female.Treatment + (1 | Sire), data = hatchRatepHOnly) #Linear mixed effect model using Sire as a random effect to investigate maternal effects
#Normality of residuals
qqnorm(residuals(hatchRatepHTreatment.lmer2))
qqline(residuals(hatchRatepHTreatment.lmer2)) #Data falls on a straight line, so it's similar to a normal distribution. There are no obvious violations of the normality assumption.
#Linearity and homoskedasticity
plot(fitted(hatchRatepHTreatment.lmer2), residuals(hatchRatepHTreatment.lmer2), xlab = "Fitted values", ylab = "Residuals")
abline(h = 0)
inSituParameters <- read.csv("data/Water-Chemistry-Data/2018-04-30-In-Situ-Variable-Calculations/2018-04-30-In-Situ-Carbonate-Chemistry-Parameters.csv", header = TRUE)
head(inSituParameters) #Confirm import
length(inSituParameters)
View(inSituParameters)
inSituParameters <- inSituParameters[1:18, ] #Keep only the lines with actual data
tail(inSituParameters) #Confirm edit
inSituParameters$Treatment <- rep(c("Low", "Low", "Low", "Ambient", "Ambient", "Ambient"), times = 3) #Add a column with treatment information
head(inSituParameters) #Confirm column addition
#pH
pHANOVA <- aov(pH ~ Treatment, data = inSituParameters) #One-way ANOVA by parental treatment
summary(pHANOVA)[[1]][["F value"]][[1]] #F = 3.10953
summary(pHANOVA)[[1]][["Pr(>F)"]][[1]] #p = 0.05082859
#Total Alkalinity
totalAlkalinityANOVA <- aov(ALK ~ Treatment, data = inSituParameters) #One-way ANOVA by parental treatment
summary(totalAlkalinityANOVA)[[1]][["F value"]][[1]] #F = 5838.781
summary(totalAlkalinityANOVA)[[1]][["Pr(>F)"]][[1]] #p = 6.116479e-22
#pCO2
pCO2ANOVA <- aov(pCO2insitu ~ Treatment, data = inSituParameters) #One-way ANOVA by parental treatment
summary(pCO2ANOVA)[[1]][["F value"]][[1]] #F = 1.381736
summary(pCO2ANOVA)[[1]][["Pr(>F)"]][[1]] #p = 0.2570017
View(inSituParameters)
#DIC
DICANOVA <- aov(DIC ~ Treatment, data = inSituParameters) #One-way ANOVA by parental treatment
summary(DICANOVA)[[1]][["F value"]][[1]] #F = 235.4018
summary(DICANOVA)[[1]][["Pr(>F)"]][[1]] #p = 5.442075e-11
#OmegaCalcite
calciteANOVA <- aov(OmegaCalcite ~ Treatment, data = inSituParameters) #One-way ANOVA by parental treatment
summary(calciteANOVA)[[1]][["F value"]][[1]] #F = 235.4018
summary(calciteANOVA)[[1]][["Pr(>F)"]][[1]] #p = 5.442075e-11
#OmegaAragonite
aragoniteANOVA <- aov(OmegaAragonite ~ Treatment, data = inSituParameters) #One-way ANOVA by parental treatment
summary(aragoniteANOVA)[[1]][["F value"]][[1]] #F = 235.4018
summary(aragoniteANOVA)[[1]][["Pr(>F)"]][[1]] #p = 5.442075e-11
summary(aragoniteANOVA)
summary(pCO2ANOVA)
mean(inSituParameters$pH[Treatment == "Low", ])
mean(inSituParameters$pH[inSituParameters$Treatment == "Low", ])
average(inSituParameters$pH[inSituParameters$Treatment == "Low", ])
mean(inSituParameters$pH[inSituParameters$Treatment == "Low", ])
mean(inSituParameters$pH[inSituParameters$Treatment == "Low"])
var((inSituParameters$pH[inSituParameters$Treatment == "Low"]))
sqrt(var((inSituParameters$pH[inSituParameters$Treatment == "Low"])))
mean(inSituParameters$pH[inSituParameters$Treatment == "Ambient"]) #Mean = 7.305762
sqrt(var((inSituParameters$pH[inSituParameters$Treatment == "Ambient"]))) #SE = 0.0178244
hatchRate <- read.csv("data/2017-07-30-Pacific-Oyster-Larvae/2018-02-14-Hatch-Rate-Data.csv", header = TRUE) #Import hatch rate data
histologyData <- read.csv("data/2017-Adult-Gigas-Tissue-Sampling/2018-02-27-Gigas-Histology-Classification.csv") #Import histology data
